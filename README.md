<p align="center"><img src="assets/top.png" width="800"/>
</p>


ä¸€æ¬¾é«˜è´¨é‡ä»¿é—²é±¼å¼€æºäº¤æ˜“å¹³å°ã€‚

Power By `å¾®ä¿¡å°ç¨‹åº`,`JWT`, `Java8`,`Maven`,`SpringBoot`,`SpringCloud`,`MySQL`,`Redis`,`RabbitMQ`,`Docker`

# ğŸ—ƒ ç›®å½•

- [åŠŸèƒ½](https://github.com/nnkwrik/weapp-fangxianyu#-%E5%8A%9F%E8%83%BD)
- [åç«¯æœåŠ¡æ‹†åˆ†](https://github.com/nnkwrik/weapp-fangxianyu#-%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86)
- [é¢„è§ˆ](https://github.com/nnkwrik/weapp-fangxianyu#-%E9%A2%84%E8%A7%88)
- [å¿«é€Ÿå¼€å§‹](https://github.com/nnkwrik/weapp-fangxianyu#-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B)
  - [å‰ç«¯](https://github.com/nnkwrik/weapp-fangxianyu#%E5%89%8D%E7%AB%AF)
  - [åç«¯](https://github.com/nnkwrik/weapp-fangxianyu#%E5%90%8E%E7%AB%AF)
  - [çœŸæœºè°ƒè¯•](https://github.com/nnkwrik/weapp-fangxianyu#%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95)
  - [ç§»é™¤dockeræ­å»ºçš„é•œåƒ](https://github.com/nnkwrik/weapp-fangxianyu#%E7%A7%BB%E9%99%A4docker%E6%90%AD%E5%BB%BA%E7%9A%84%E9%95%9C%E5%83%8F)
- [édocker-composeéƒ¨ç½²](https://github.com/nnkwrik/weapp-fangxianyu#-%E9%9D%9Edocker-compose%E9%83%A8%E7%BD%B2)
- [ç«¯å£](https://github.com/nnkwrik/weapp-fangxianyu#-%E7%AB%AF%E5%8F%A3)
  - [docker-composeç¯å¢ƒä¸‹](https://github.com/nnkwrik/weapp-fangxianyu#docker-compose%E7%8E%AF%E5%A2%83%E4%B8%8B)
  - [édocker-composeç¯å¢ƒä¸‹](https://github.com/nnkwrik/weapp-fangxianyu#%E9%9D%9Edocker-compose%E7%8E%AF%E5%A2%83%E4%B8%8B)
- [JWT](https://github.com/nnkwrik/weapp-fangxianyu#-jwt)
- [æœ€å](https://github.com/nnkwrik/weapp-fangxianyu#%E6%9C%80%E5%90%8E)

# ğŸŒ€ åŠŸèƒ½

- é¦–é¡µ : å¹¿å‘Šbanner,æ¨èåˆ†ç±»,æ¨èå•†å“
- åˆ†ç±»åŠŸèƒ½ : 2çº§åˆ†ç±»,åˆ†ç±»æµè§ˆå•†å“
- æœç´¢åŠŸèƒ½ : å…³é”®å­—æœç´¢,æœç´¢å†å²,çƒ­é—¨å…³é”®å­—,æœç´¢è¾…åŠ©,
- æµè§ˆå•†å“è¯¦æƒ… :  å•†å“ä¿¡æ¯,2çº§è¯„è®º,å–å®¶ä¿¡æ¯,ç›¸å…³å•†å“,æ ‡è®°ä¸ºæ”¶è—,æ ‡è®°ä¸ºæƒ³è¦
- å‘å¸ƒå•†å“ : ä¸Šä¼ å•†å“å›¾,å‘è´§åœ°ç‚¹,æ”¯æŒå¤šç§äº¤æ˜“æ–¹å¼
- èŠå¤©åŠŸèƒ½ : åŸºäºWebSocket,æ ‡è®°ä¸ºæƒ³è¦ååˆ›å»ºå¯¹è¯(æ¨¡ä»¿é—²é±¼),åœ¨èŠå¤©æ¡†ä¸­ä¸‹å•(æ¨¡ä»¿é—²é±¼)
- å…¶ä»–åŠŸèƒ½ : ç”¨æˆ·ä¸»é¡µ,æŸ¥çœ‹è‡ªå·±å‘å¸ƒ,æ”¶è—,å–å‡º,ä¹°åˆ°çš„å•†å“
- è®¢å•,æ”¯ä»˜ : **æœªå®Œæˆ**



# ğŸ–‡ åç«¯æœåŠ¡æ‹†åˆ†

åç«¯åŸºäºSpring Cloudæ­å»º,æ‹†åˆ†ä¸º`è®¤è¯`,`ç”¨æˆ·`,`æ¶ˆæ¯`,`å•†å“`,`æœåŠ¡å‘ç°`,`ç½‘å…³`6ä¸ªæœåŠ¡

![1545121316436](assets/1545121316436.png)



# ğŸ—º é¢„è§ˆ

<p align="center">
    <img src="assets/347252446.jpg" style="margin:20px;border:1px solid #eee" width="350" />
    <img src="assets/20025781.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/935521060.jpg"  style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/1900355585.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/1988065609.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/1565722579.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/1130381648.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
    <img src="assets/619991011.jpg" style="margin:20px;border:1px solid #eee" width="350"/>
</p>

# ğŸš€ å¿«é€Ÿå¼€å§‹

## å‰ç«¯

ç„¶è€Œå¹¶ä¸èƒ½å¿«é€Ÿå¼€å§‹ï¼Œé¦–å…ˆä½ å¾—æœ‰å°ç¨‹åºçš„appidã€‚éœ€è¦å…ˆç”³è¯·å°ç¨‹åºè´¦å·å’Œä¸‹è½½å°ç¨‹åºå¼€å‘å·¥å…·ï¼Œæ­¥éª¤å¯ä»¥å‚è€ƒ[å®˜æ–¹æ•™ç¨‹](https://developers.weixin.qq.com/miniprogram/dev/)ã€‚æ³¨å†Œå®Œæˆåä¼šæ‹¿åˆ°appidå’Œsecretï¼Œåœ¨`auth-service/src/main/resources/application.yml`ä¸­é…ç½®ä½ çš„appidå’Œsecretã€‚

```yml
#å†™å…¥ä½ çš„å°ç¨‹åºä¿¡æ¯
wx:
  miniapp:
    appid:  #å¾®ä¿¡å°ç¨‹åºçš„appid
    secret: #å¾®ä¿¡å°ç¨‹åºçš„Secret
    msgDataFormat: JSON
```

æ‰“å¼€åˆšä¸‹è½½å¥½çš„å°ç¨‹åºå¼€å‘å·¥å…·ï¼Œåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚ç„¶åæŠŠ[wx-front](https://github.com/nnkwrik/fangxianyu/tree/master/wx-front)ä¸­çš„æ‰€æœ‰æ–‡ä»¶è¦†ç›–åˆ°ä½ åˆšåˆ›å»ºçš„å°ç¨‹åºé¡¹ç›®ç›®å½•ä¸­ã€‚ç”±äºå°ç¨‹åºé»˜è®¤æœåŠ¡ç«¯åªèƒ½æ˜¯HTTPSå¹¶ä¸”æ˜¯ICPå¤‡æ¡ˆè¿‡çš„åŸŸåï¼Œä¸æ–¹ä¾¿å¼€å‘ï¼Œåœ¨å°ç¨‹åºå¼€å‘å·¥å…·çš„`è®¾ç½®/é¡¹ç›®è®¾ç½®`ä¸­æŠŠ`ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦`å‹¾ä¸Šã€‚

## åç«¯

åç«¯ç”¨docker-composeå¿«é€Ÿéƒ¨ç½²ï¼Œç¡®ä¿ä½ å®‰è£…äº†dockerå’Œdocker-composeã€‚ï¼ˆå‚è€ƒï¼š[Ubuntuå®‰è£…Docker](https://docs.docker.com/install/linux/docker-ce/ubuntu/)ï¼Œ[å®‰è£…docker-compose](https://docs.docker.com/compose/install/)ï¼‰ã€‚

```
$ git clone git@github.com:nnkwrik/weapp-fangxianyu.git
$ cd /weapp-fangxianyu
```

mavenæ‰“åŒ…

```
mvn clean package -Dmaven.test.skip=true
```

æ‰“å¼€docker-compose.ymlçœ‹ä¸€ä¸‹ï¼Œç¡®ä¿å’Œä½ æœ¬æœºçš„ç«¯å£æ²¡æœ‰å†²çªã€‚ç„¶åå°±å¯ä»¥dockeréƒ¨ç½²å•¦

```
$ docker-compose build
$ docker-compose up
```

éƒ¨ç½²å®Œæˆåç¨ç­‰ç‰‡åˆ»ï¼ˆç½‘å…³å®Œå…¨å¯åŠ¨æ¯”è¾ƒè€—æ—¶ï¼‰ï¼Œæ‰“å¼€ä½ çš„å°ç¨‹åºå¼€å‘å·¥å…·ï¼Œç‚¹å‡»ä¸Šæ–¹çš„`ç¼–è¯‘`å°±å¯ä»¥çœ‹åˆ°ä¸»é¡µäº†ã€‚

![1545124207261](assets/1545124207261.png)

## çœŸæœºè°ƒè¯•

å› ä¸ºç°åœ¨åŸŸåç”¨çš„æ˜¯localhostï¼Œæ‰‹æœºæ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œéœ€è¦å†…ç½‘ç©¿é€ã€‚æˆ‘åœ¨dev/ngrok/ä¸‹æ”¾äº†linuxç‰ˆæœ¬çš„ngrokï¼Œå¦‚æœä½ ä¹Ÿæ˜¯linuxç³»ç»Ÿï¼Œç›´æ¥è¿è¡Œé‡Œé¢çš„ç›®å½•ä¸‹çš„`start.sh`å°±è¡Œäº†ï¼Œåˆ«çš„ç³»ç»Ÿçš„è¯å»è°·æ­Œæ‰¾ä¸€ä¸‹.. éšåä¼šå¾—åˆ°ä¸€ä¸ªéšæœºçš„åŸŸåï¼ˆwebsocketé€šç”¨ï¼‰ï¼ŒæŠŠå®ƒé…ç½®åˆ°å°ç¨‹åºå‰ç«¯çš„config/api.jsä¸‹ï¼Œæ›¿æ¢åŸæ¥çš„localhost:8080ã€‚ç„¶åç‚¹`çœŸæœºè°ƒè¯•`å°±èƒ½é€šè¿‡æ‰‹æœºè®¿é—®åˆ°æœåŠ¡ç«¯äº†ã€‚

## ç§»é™¤dockeræ­å»ºçš„é•œåƒ

ä¸æƒ³ç”¨äº†ï¼Ÿ åˆ é™¤æ‰€æœ‰ç›¸å…³é•œåƒ

```
$ docker-compose down
$ docker rmi $(docker images | grep fangxianyu |  awk '{print $3}')
```



# ğŸ¢ édocker-composeéƒ¨ç½²

ä¸æƒ³ç”¨docker-composeå°±åªèƒ½ä¸€æ­¥æ­¥æ¥äº†ã€‚

- å…ˆå¯åŠ¨3ä¸ªåŸºç¡€æœåŠ¡ã€‚è¿è¡Œ`dev/mysql`,`dev/redis`,`dev/rebbitmq`ç›®å½•ä¸‹çš„`start.sh`ã€‚

- æŠŠ6ä¸ªæœåŠ¡ï¼ˆ`auth-service`,`goods-service`,`user-service`,`im-service`,`eureka`,`gateway`ï¼‰ä¸‹Applicationå¯åŠ¨ç±»è·‘èµ·æ¥ã€‚

å…¶ä»–å’Œå¿«é€Ÿå¼€å§‹ä¸€æ ·



# ğŸ“¡ ç«¯å£

### docker-composeç¯å¢ƒä¸‹

- MySQL : 3306
- Redis ï¼š 6379
- Rabbit MQ ï¼š 5672 ï¼ˆç®¡ç†ç•Œé¢ï¼š15672ï¼‰
- gateway : 8080

å…·ä½“å‚è€ƒ`docker-compose.yml`ã€‚åŸºç¡€æœåŠ¡çš„ç«¯å£éƒ½å¯ä»¥ä¸æš´éœ²ï¼Œæš´éœ²å‡ºæ¥æ˜¯ä¸ºäº†æ–¹ä¾¿ç”Ÿäº§ç¯å¢ƒä¸­è°ƒè¯•

### édocker-composeç¯å¢ƒä¸‹

- MySQL : 3306
- Redis ï¼š 6379
- Rabbit MQ ï¼š 5672 ï¼ˆç®¡ç†ç•Œé¢ï¼š15672ï¼‰
- gateway ï¼š 8080
- eureka ï¼š8801
- user-service ï¼š 8802
- auth-service ï¼š 8803
- goods-service ï¼š8804
- im-service ï¼š8805


# ğŸ”‘ JWT

åç«¯APIåŸºäºHeaderä¸­çš„JWT Tokenè¿›è¡Œè®¤è¯ã€‚å¦‚æœä½ è¿˜ä¸äº†è§£JWTçš„è¯å¯ä»¥å…ˆäº†è§£ä¸‹ï¼Œå¾®æœåŠ¡è®¤è¯çš„ç¥å™¨ã€‚

controllerä¸­é€šè¿‡@JWTæ³¨è§£æŠŠTokenè¿›è¡Œè®¤è¯åè½¬æˆJWTUserç±»ã€‚å…·ä½“å‚è€ƒå„ä¸ªcontrollerä¸­çš„ä»£ç ã€‚åœ¨ymlä¸­å¯ä»¥é…ç½®ç§˜é’¥æ–‡ä»¶çš„åå­—å¦‚ï¼š

```yml
jwt:
  pvt-key-file-name: RSA.key
  pub-key-file-name: RSA.pub
  duration: 1D  #JWT 1å¤©è¿‡æœŸ
```

è¯·ç¡®ä¿resourceç›®å½•ä¸‹æœ‰ä½ é…ç½®çš„è¿™ä¸ªç§˜é’¥æ–‡ä»¶ã€‚JWTå‘è¡Œæ–¹ï¼ˆauth-serviceï¼‰éœ€è¦ç§é’¥ï¼ˆ.keyï¼‰,éªŒè¯æ–¹ï¼ˆgoods-service,im-serviceï¼‰éœ€è¦å…¬é’¥ï¼ˆ.pubï¼‰ã€‚

å¦‚æœä½ æƒ³æ”¹æˆæ–°çš„ç§˜é’¥ï¼Œ`io.github.nnkwrik.authservice.token.RSAKeysGenerator`ä¸­æä¾›äº†RSAå¯†é’¥å¯¹ç”Ÿæˆå™¨ã€‚è¿è¡Œåä¼šåœ¨`auth-service/src/main/resources`ä¸‹ç”Ÿæˆæ–°çš„ç§˜é’¥å¯¹ï¼ˆ.keyå’Œ.pubï¼‰ã€‚æŠŠå…¬é’¥ï¼ˆ.pubï¼‰å¤åˆ¶åˆ°éœ€è¦JWTéªŒè¯çš„æœåŠ¡ï¼ˆ`goods-service`,`im-service`ï¼‰çš„resourceä¸‹ï¼Œå°±èƒ½æ›¿æ¢æˆæ–°çš„ç§˜é’¥äº†ã€‚



# æœ€å

- **åˆ«å¿˜è®°Starï¼**
- åç«¯è°ƒç”¨å¾®ä¿¡apiè®¤è¯çš„éƒ¨åˆ†ç”¨åˆ°äº†[å¾®ä¿¡Javaå¼€å‘å·¥å…·åŒ…](https://github.com/Wechat-Group/weixin-java-tools)çš„`weixin-java-miniapp`ï¼Œéå¸¸æ„Ÿè°¢
- å‰ç«¯å‚è€ƒäº†[NideShopå•†åŸ](https://github.com/tumobi/nideshop-mini-program)å°ç¨‹åºï¼Œéå¸¸æ„Ÿè°¢
- è®¢å•å’Œæ”¯ä»˜æ²¡æœ‰å®Œæˆï¼Œéšç¼˜å¼€å‘ã€‚
  [NideShopå•†åŸ](https://github.com/tumobi/nideshop-mini-program)é‡Œå¥½åƒå·²ç»æœ‰æ”¯ä»˜å’Œè®¢å•çš„é¡µé¢ï¼Œæœ‰å…´è¶£åšäºŒæ¬¡å¼€å‘çš„è¯å¯ä»¥å‚è€ƒä¸€ä¸‹
- è¿™æ¬¡å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘éƒ½æœ‰åœ¨åšå®¢ä¸­åšè®°å½•ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹
  - [Spring Cloudä¸­ä½¿ç”¨RabbitMQçš„ä¸¤ç§æ–¹å¼](https://nnkwrik.github.io/2018/11/19/20181119/)
  - [Guavaçš„Cache](https://nnkwrik.github.io/2018/11/20/20181120/)
  - [ä¸‡èƒ½çš„Jackson](https://nnkwrik.github.io/2018/11/30/20181130/)
- æœ‰é—®é¢˜å—ï¼Ÿå¾®ä¿¡å·ï¼šnnkwrik